<!-- Portfolio Modal 2 -->
<div class="portfolio-modal modal fade" id="viewparkingModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-content">
        <div class="close-modal" data-dismiss="modal">
            <div class="lr">
                <div class="rl">
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2">
                    <div class="modal-body"> 
                        <div id="parkingContent"></div>
                        <div id="cal-heatmap"></div>
                        <div id="parkingPhotos"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">          
            <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</button>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).on('click','.parkdetails',function(){
    //$('#btnBookParking').data('park',$(this).data('pk'));
    var park_pk=$(this).data('pk');
    $.get("{% url 'parkingdetails' %}",{pk: $(this).data('pk') })
    .done(function(datas) {     
        if (datas.avail){
            var avail_txt ='<hr><p class="lead"> Time Available<br></p> Click Available Timings to book.';
            //<h3><small>Total Parking Spaces Vacant:</small> <span class="label label-primary">' 
            //+  datas.spaces +'</span></h3>'
            //<kbd>' + datas.ftime +'</kbd> - <kbd>' + datas.totime + '</kbd>
            //
            //var dts=JSON.parse(datas.avail);
            //for (var k in dts){
            //    if (dts.hasOwnProperty(k)) {
            //         alert("Key is " + k + ", value is" + dts[k]);
            //    }
            //}

            //HEAT MAP
            $("#cal-heatmap").empty();
            var cal = new CalHeatMap();
            cal.init({
                itemSelector: "#cal-heatmap",
                domain: "day",
                subDomain: "hour",
                subDomainTextFormat: "%H",
                rowLimit: 1,
                domainGutter: 0,
                data: JSON.parse(datas.avail),
                start: new Date(),
                cellSize: 30,
                cellPadding: 5,
                range: 7,
                verticalOrientation: true,
                label: {
                    position: "left",
                    offset: {
                        x: 20,
                        y: 12
                    },
                    width: 110
                },
                onClick: function(date, nb) {
                    //var sdate=date.toDateString();
                    //alert(sdate.slice(0, 16));
                    if (nb){
                        var dur = prompt("Book Parking Space on "+
                            date+". Please Enter Duration in Hours", '1');
                        if (dur > 0) {
                            //redirect to paypal, remember date,duration & park_id
                            $.get("{% url 'savebooking' %}",
                                {'park':park_pk,'time':date,'duration':dur})
                            .done(function(data){
                              alert(data.msg);
                              if (data.status){
                                window.location="{% url 'users' request.user %}";
                              }else if(data.msg=='login'){
                                window.location="{% url "account_login" %}";
                              }
                            });
                        }
                    }
                    /*
                    if (sdate.slice(0, 16)=='Wed Jan 05 2000'){
                        alert('it works');
                    }else{
                        $("#onClick-placeholder").html("You just clicked <br/>on <b>" +
                            date + "</b> <br/>with <b>" +
                            (nb === null ? "unknown" : nb) + "</b> items"
                        );
                    }*/
                        
                }
            });

            
        }else{
            var avail_txt ='<h3> <span class="label label-danger">Sorry There is no parking space is available on today</span></h3>';            
        }

        var str_html='<h2>Parking Details</h2><p class="item-intro text-muted">'+
        datas.address+'</p>'+'<p><strong>Description:</strong>'+datas.desc+'</p>'+avail_txt;

        if (datas.pic){
            $("#parkingPhotos").html('<hr><p class="lead">Parking Photos:</p><img class="img-responsive img-centered" src="'+datas.pic+'_crop.jpg" alt="">');
        }

        $('#parkingContent').html(str_html);
    });
});
$(document).on('click','#btnBookParking',function(){
  var datas={'park':$(this).data('park'),'time':$('#pfromtime').val(),
            'duration':$('#pduration').val()};
  $.get("{% url 'savebooking' %}",datas).done(function(result){
      alert(result);
  });
});
</script>

